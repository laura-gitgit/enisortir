{% extends 'base.html.twig' %}

{% block body %}
    <div>
        {% if app.user %}
            <p>Date du jour : {{ date | date('d/m/Y') }}</p>
            <p>Participant : {{ app.user.prenom }}</p>
        {% endif %}
    </div>

    <form action="{{ path('_main_tri') }}" method="get" name="triSorties">
        <div>
            <p>Filter les sorties</p>
            <p>Site :
                <select name="site" id="site">
                    {% for site in sites %}
                        <option value="{{ site.nom }}">{{ site.nom }}</option>
                    {% endfor %}
                </select>
            </p>
            <p>Le nom de la sortie contient :
                <input type="text" class="nomSortie" name="nomSortie">
            </p>
            <p>
                Entre
                <input type="date" name="debutSortie" id="debutSortie">
                et
                <input type="date" name="finSortie" id="finSortie">
            </p>
        </div>
        <div class="sorties_triees">
            <p>
                <input type="checkbox" name="organisateur" id="organisateur">
                Sorties dont je suis l'organisateur/trice
            </p>
            <p>
                <input type="checkbox" name="inscrit" id="inscrit">
                Sorties auxquelles je suis inscrit/e
            </p>
            <p>
                <input type="checkbox" name="nonInscrit" id="non_inscrit">
                Sorties auxquelles je ne suis pas inscrit/e
            </p>
            <p>
                <input type="checkbox" name="sortiesPassees" id="sorties_passees">
                Sorties passées
            </p>
        </div>
        <input type="submit" value="Rechercher" name="validerRechercher">
    </form>
    <div class="sortiesAll">
        <h4>Nom de la sortie </h4>
        <h4>Date de la sortie </h4>
        <h4>Clôture</h4>
        <h4>Inscrits/places </h4>
        <h4>Etat </h4>
        <h4>Inscrit </h4>
        <h4>Organisateur </h4>
        <h4>Actions</h4>
    </div>
    <div class="sorties">
        {% for sortie in sorties %}
            <div>{{ sortie.nom }}</div>
            <div>{{ sortie.dateHeureDebut | date('d/m/Y') }}</div>
            <div>{{ sortie.dateLimiteInscription | date('d/m/Y')  }}</div>
            <div>{{ sortie.participants | length }} /{{ sortie.nbInscriptionsMax }}</div>
            <div>{{ sortie.etat.libelle }}</div>
            <div>
                {% for participant in sortie.participants %}
                    {%  if participant == app.user %}
                        X
                    {%  endif %}
                {% endfor %}
            </div>
            <div><a href="{{ path('profil_details', {'id': sortie.organisateur.id}) }}">{{ sortie.organisateur.pseudo }}</a></div>
            <div>
                {%  if sortie.organisateur != app.user and sortie.participants | length < sortie.nbInscriptionsMax %}
                    <a href="{{ path('sortie_detail', {'id': sortie.id}) }}">Afficher - </a>
                    {#  TODO inscription à une sortie #}
                    {% if app.user not in sortie.participants %}
                        <a href="">S'inscrire</a>
                    {% endif %}
                    {% if  app.user in sortie.participants %}
                        <a href="">Se désister</a>
                    {% endif %}
                {% elseif sortie.organisateur == app.user %}
                    <a href="{{ path('sortie_detail', {'id': sortie.id}) }}">Modifier</a>
                    {% if sortie.etat.libelle == 'Créée' %}
                        <a href="">Publier</a>
                    {%  endif %}
                    {% if sortie.etat.libelle == 'Ouverte' %}
                        <a href="">Annuler</a>
                    {%  endif %}
                {%  endif %}
            </div>
        {% endfor %}
    </div>
    <a href="{{ path('sortie_creation') }}">
        <button name="CréerSortie">Créer une sortie</button>
    </a>

{% endblock %}

